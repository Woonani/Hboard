### 집 환경 설정

# 디렉토리 구조
C:.
?  docker-compose.yaml
?  
??nginx
?  ??conf.d
?          default.conf
?          
??php
?      Dockerfile
?      
??web
    ??.vscode
    ?      settings.json
    ?      
    ??frontend
        ?  .gitignore
        ?  404.html
        ?  index.html
        ?  
        ??controller
        ?      step_02.php
        ?      step_03.php
        ?      
        ??include
        ?      footer.php
        ?      header.php
        ?      
        ??js
        ?  ??member
        ?          step_01.js
        ?          step_02.js
        ?          step_03.js
        ?          
        ??member
        ?      index.php
        ?      step_01.html
        ?      step_02.html
        ?      step_03.html
        ?      
        ??model
               dbconfig.php
               index.html
        
                    



# docker-compose.yaml
services:
  nginxweb:
    image: nginx:latest
    ports:
      - "80:80"
    volumes:
      - ./nginx/conf.d/default.conf:/etc/nginx/conf.d/default.conf
      - ./web/frontend:/var/www/html/app
  phpapp:
    build:
      dockerfile: ./php/Dockerfile
    volumes:
      - ./web/frontend:/var/www/html/app

# default.conf
server {
    listen       80;
    server_name  test.hackers.com;
    
    root /var/www/html/app;
    index index.html;

    location = / {
        try_files /index.html =404;
    }

    location ~ \.php$ {
        fastcgi_pass    phpapp:9000;
        fastcgi_index   index.php;
        fastcgi_param   REQUEST_METHOD $request_method;
        fastcgi_param   SCRIPT_FILENAME $document_root$fastcgi_script_name;
        include         fastcgi_params;
    }

    location / {
        try_files $uri/ /index.php?query_string;
    }
}

# Dockerfile
FROM php:8.2-fpm-alpine

RUN docker-php-ext-install pdo pdo_mysql



# Docker IP
docker inspect -f '{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}' mysql


# DB 
sh-4.4# mysql -u root -p
Enter password: 
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 8
Server version: 8.2.0 MySQL Community Server - GPL

Copyright (c) 2000, 2023, Oracle and/or its affiliates.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql>

mysql> create user 'hackers'@'%' IDENTIFIED with mysql_native_password BY 'hackers1234!';
Query OK, 0 rows affected (0.01 sec)

mysql> CREATE DATABASE Hboard;
Query OK, 1 row affected (0.01 sec)

mysql> GRANT ALL PRIVILEGES ON Hboard.* TO 'hackers'@'%';
Query OK, 0 rows affected (0.01 sec)

mysql> FLUSH PRIVILEGES;
Query OK, 0 rows affected (0.00 sec)

# mysql docker container files
/etc/my.cnf 경로 
# For advice on how to change settings please see
# http://dev.mysql.com/doc/refman/8.2/en/server-configuration-defaults.html

[mysqld]

skip-host-cache
skip-name-resolve
datadir=/var/lib/mysql
socket=/var/run/mysqld/mysqld.sock
secure-file-priv=/var/lib/mysql-files
user=mysql

pid-file=/var/run/mysqld/mysqld.pid
[client]
socket=/var/run/mysqld/mysqld.sock

!includedir /etc/mysql/conf.d/
